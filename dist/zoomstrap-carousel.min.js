class ZoomStrapCarousel{constructor(e={}){this.config={zoomFactor:1.5,animationDuration:300,mobileIconSize:24,carouselSelector:"#product-carousel"},Object.assign(this.config,e),this.state={active:{item:null,zoomMode:!1},position:{x:50,y:50},isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),initialized:!1},this.carousel=null,"complete"===document.readyState||"interactive"===document.readyState?this.init():document.addEventListener("DOMContentLoaded",(()=>this.init()))}init(){this.state.initialized||(this.carousel=document.querySelector(this.config.carouselSelector),this.carousel?(this.carousel.dataset.zoomFactor&&(this.config.zoomFactor=parseFloat(this.carousel.dataset.zoomFactor)),this.carousel.dataset.animationDuration&&(this.config.animationDuration=parseInt(this.carousel.dataset.animationDuration)),this.addZoomStyles(),this.state.isMobile?this.addMobileZoomIcons():(document.addEventListener("click",(e=>this.handleZoomToggle(e))),this.carousel.addEventListener("mousemove",(e=>this.updateZoomPosition(e)))),this.carousel.addEventListener("slide.bs.carousel",(e=>this.handleCarouselSlide(e))),window.addEventListener("resize",(()=>this.exitZoomMode())),this.setupDoubleTapDetection(),this.modifyCarouselBehavior(),this.state.initialized=!0):console.warn(`ZoomGallery: Could not find carousel with selector "${this.config.carouselSelector}"`))}addZoomStyles(){if(document.getElementById("zoom-gallery-styles"))return;this.config.carouselSelector.replace(/^[.#]/,"");const e=`\n        .zoom-mode { \n            position: relative; \n            overflow: hidden; \n            cursor: zoom-out; \n        }\n        \n        ${this.config.carouselSelector}:not(.zoom-mode) .carousel-item img { \n            cursor: zoom-in; \n        }\n        \n        .zoom-active { \n            position: relative; \n            z-index: 5; \n        }\n        \n        .carousel-item img {\n            transition: transform ${this.config.animationDuration}ms ease-out;\n            width: 100%;\n            height: auto;\n        }\n        \n        .zoom-mode * { \n            user-select: none; \n            -webkit-user-select: none; \n        }\n        \n        .mobile-zoom-icon {\n            position: absolute;\n            bottom: 10px;\n            right: 10px;\n            background-color: rgba(255, 255, 255, 0.7);\n            border-radius: 50%;\n            padding: 8px;\n            cursor: pointer;\n            z-index: 10;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\n            transition: transform 0.2s ease;\n        }\n        \n        .mobile-zoom-icon:hover {\n            transform: scale(1.1);\n        }\n        \n        .mobile-zoom-icon svg {\n            display: block;\n        }\n        \n        .mobile-gallery-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.9);\n            z-index: 9999;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        \n        .mobile-gallery-container {\n            position: relative;\n            width: 100%;\n            height: 80%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 10001;\n        }\n        \n        .mobile-gallery-img {\n            max-width: 100%;\n            max-height: 100%;\n            object-fit: contain;\n            user-select: none;\n            -webkit-user-select: none;\n        }\n        \n        .mobile-gallery-close {\n            position: fixed;\n            top: 15px;\n            right: 15px;\n            color: white;\n            font-size: 30px;\n            width: 40px;\n            height: 40px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            background-color: rgba(0, 0, 0, 0.5);\n            border-radius: 50%;\n            cursor: pointer;\n            z-index: 10000;\n        }\n        \n        .mobile-gallery-reset {\n            position: fixed;\n            bottom: 15px;\n            left: 50%;\n            transform: translateX(-50%);\n            color: white;\n            background-color: rgba(0, 0, 0, 0.5);\n            padding: 8px 16px;\n            border-radius: 20px;\n            cursor: pointer;\n            z-index: 10000;\n            font-size: 14px;\n        }\n        \n        @media (max-width: 768px) {\n            body:has(.mobile-gallery-overlay) .carousel-control-prev,\n            body:has(.mobile-gallery-overlay) .carousel-control-next {\n                display: none;\n            }\n            \n            .mobile-zoom-icon {\n                width: 40px;\n                height: 40px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n        }\n        `,t=document.createElement("style");t.id="zoom-gallery-styles",t.textContent=e,document.head.appendChild(t)}addMobileZoomIcons(){const e=this.createZoomIconTemplate();this.carousel.querySelectorAll(".carousel-item").forEach((t=>{"static"===getComputedStyle(t).position&&(t.style.position="relative");const o=e.cloneNode(!0);o.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.openMobileGalleryView(t)})),t.appendChild(o)}))}createZoomIconTemplate(){const e=document.createElement("div");return e.className="mobile-zoom-icon",e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="${this.config.mobileIconSize}" height="${this.config.mobileIconSize}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>`,e}openMobileGalleryView(e){const t=e.querySelector("img");if(!t)return;const o=window.scrollY,i=document.createElement("div");i.className="mobile-gallery-overlay";const n=document.createElement("div");n.className="mobile-gallery-container";const s=document.createElement("img");s.className="mobile-gallery-img",s.src=t.src,s.alt=t.alt||"Product image";const a=document.createElement("div");a.className="mobile-gallery-close",a.innerHTML="Ã—",document.documentElement.style.position="fixed",document.documentElement.style.overflow="hidden",document.documentElement.style.width="100%",document.documentElement.style.top=`-${o}px`,a.addEventListener("click",(()=>{document.documentElement.style.position="",document.documentElement.style.overflow="",document.documentElement.style.width="",document.documentElement.style.top="",window.scrollTo(0,o),document.body.removeChild(i)})),n.appendChild(s),i.appendChild(n),i.appendChild(a),document.body.appendChild(i);const r=function(e){if(e.target===s)return!0;e.preventDefault()};document.addEventListener("touchmove",r,{passive:!1}),a.addEventListener("click",(()=>{document.removeEventListener("touchmove",r)}),{once:!0})}setupDoubleTapDetection(){let e=0;this.carousel.addEventListener("dblclick",(e=>{this.state.active.zoomMode&&this.exitZoomMode()})),this.carousel.addEventListener("touchend",(t=>{const o=(new Date).getTime(),i=o-e;i<300&&i>0&&(this.state.active.zoomMode&&this.exitZoomMode(),t.preventDefault()),e=o}))}handleCarouselSlide(e){if(this.state.active.zoomMode)return e.preventDefault(),e.stopPropagation(),!1;this.exitZoomMode()}modifyCarouselBehavior(){if("undefined"!=typeof bootstrap&&bootstrap.Carousel)try{const e=bootstrap.Carousel.getInstance(this.carousel);if(!e)return;const t=e.cycle,o=e.pause;e.cycle=()=>{this.state.active.zoomMode||t.call(e)},e.pause=()=>{o.call(e)}}catch(e){console.warn("Bootstrap carousel modification failed:",e)}}handleZoomToggle(e){if(!this.state.isMobile&&!e.target.closest(".carousel-control-prev, .carousel-control-next"))if(this.state.active.zoomMode)this.exitZoomMode();else{const t=this.carousel.querySelector(".carousel-item.active");if(!t)return;this.carousel.contains(e.target)&&this.enterZoomMode(t,e)}}updateZoomPosition(e){if(!this.state.active.zoomMode||this.state.isMobile)return;const t=this.state.active.item.querySelector("img");if(!t)return;const o=this.state.active.item.getBoundingClientRect();this.state.position.x=Math.max(0,Math.min(100,(e.clientX-o.left)/o.width*100)),this.state.position.y=Math.max(0,Math.min(100,(e.clientY-o.top)/o.height*100)),t.style.transformOrigin=`${this.state.position.x}% ${this.state.position.y}%`}enterZoomMode(e,t){if(this.state.isMobile)return;const o=e.querySelector("img");if(!o)return;this.state.active.item=e,this.state.active.zoomMode=!0;const i=e.getBoundingClientRect();if(this.state.position.x=(t.clientX-i.left)/i.width*100,this.state.position.y=(t.clientY-i.top)/i.height*100,this.carousel.classList.add("zoom-mode"),e.classList.add("zoom-active"),o.style.transformOrigin=`${this.state.position.x}% ${this.state.position.y}%`,o.style.transform=`scale(${this.config.zoomFactor})`,this.toggleCarouselControls(!1),"undefined"!=typeof bootstrap&&bootstrap.Carousel)try{const e=bootstrap.Carousel.getInstance(this.carousel);e&&(this.carousel.hasAttribute("data-bs-ride")&&(this.carousel.dataset.bsRide=this.carousel.getAttribute("data-bs-ride")),e.pause(),this.carousel.dataset.manuallyPaused="true",this.carousel.removeAttribute("data-bs-ride"))}catch(e){console.warn("Bootstrap carousel instance not available:",e)}}exitZoomMode(){if(!this.state.active.zoomMode||!this.state.active.item)return;const e=this.state.active.item.querySelector("img");e&&(e.style.transformOrigin=`${this.state.position.x}% ${this.state.position.y}%`,e.style.transform="scale(1)"),this.carousel.classList.remove("zoom-mode"),this.state.active.item.classList.remove("zoom-active"),this.toggleCarouselControls(!0),this.resumeCarousel(),this.state.active.item=null,this.state.active.zoomMode=!1}resumeCarousel(){if("undefined"!=typeof bootstrap&&bootstrap.Carousel)try{const e=bootstrap.Carousel.getInstance(this.carousel);e&&"true"===this.carousel.dataset.manuallyPaused&&(this.carousel.dataset.bsRide?this.carousel.setAttribute("data-bs-ride",this.carousel.dataset.bsRide):this.carousel.setAttribute("data-bs-ride","carousel"),delete this.carousel.dataset.manuallyPaused,e.cycle())}catch(e){console.warn("Bootstrap carousel resume failed:",e)}}toggleCarouselControls(e){const t=this.carousel.querySelector(".carousel-control-prev"),o=this.carousel.querySelector(".carousel-control-next"),i=this.carousel.querySelector(".carousel-indicators");t&&(t.style.display=e?"":"none"),o&&(o.style.display=e?"":"none"),i&&(i.style.display=e?"":"none")}}window.ZoomStrapCarousel=ZoomStrapCarousel;